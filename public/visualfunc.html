<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <link rel="stylesheet" href="visualfunc.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Perfil do Funcion√°rio - Est√©tica Automotiva</title>
    </head>
    <body>
        <header class="header">
            <div class="diagonal-lines">
                <div class="line line1"></div>
                <div class="line line2"></div>
                <div class="line line3"></div>
                <div class="line line4"></div>
                <div class="line line5"></div>
                <div class="line line6"></div>
            </div>
            <div class="header-content">
                <a
                    href="#"
                    class="back-button"
                    onclick="window.history.back(); return false;"
                    >‚Üê Voltar</a
                >
                <div class="header-title">
                    <h1>Funcion√°rios Cadastrados</h1>
                </div>
                <div style="width: 100px"></div>
            </div>
        </header>

        <div class="container">
            <div class="top-section">
                <div class="search-filter-section">
                    <div class="form-group">
                        <label>Buscar:</label>
                        <input
                            type="text"
                            id="searchInput"
                            placeholder="Nome ou matr√≠cula"
                        />
                    </div>
                    <div class="form-group">
                        <label>Cargo:</label>
                        <select id="filterCargo">
                            <option value="">Todos</option>
                            <option value="Especialista T√©cnico">
                                Especialista T√©cnico
                            </option>
                            <option value="Polidor">Polidor</option>
                            <option value="Lavador">Lavador</option>
                            <option value="Vitrificador">Vitrificador</option>
                            <option value="Gerente">Gerente</option>
                            <option value="Supervisor">Supervisor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Departamento:</label>
                        <select id="filterDepartamento">
                            <option value="">Todos</option>
                            <option value="Servi√ßos Especializados">
                                Servi√ßos Especializados
                            </option>
                            <option value="Est√©tica B√°sica">
                                Est√©tica B√°sica
                            </option>
                            <option value="Polimento e Vitrifica√ß√£o">
                                Polimento e Vitrifica√ß√£o
                            </option>
                            <option value="Administrativo">
                                Administrativo
                            </option>
                        </select>
                    </div>
                    <button class="btn-search" onclick="filterEmployees()">
                        üîç Buscar
                    </button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total de Funcion√°rios</h3>
                    <div class="stat-number" id="totalEmployees">0</div>
                </div>
                <div class="stat-card">
                    <h3>Ativos</h3>
                    <div class="stat-number" id="activeEmployees">0</div>
                </div>
                <div class="stat-card">
                    <h3>Em F√©rias</h3>
                    <div class="stat-number" id="vacationEmployees">0</div>
                </div>
                <div class="stat-card">
                    <h3>M√©dia Salarial</h3>
                    <div class="stat-number" id="avgSalary">R$ 0</div>
                </div>
            </div>

            <div class="employees-container">
                <h2>üë• Lista de Funcion√°rios</h2>

                <div class="view-toggle">
                    <button
                        class="toggle-btn active"
                        onclick="switchView('table')"
                    >
                        üìã Tabela
                    </button>
                    <button class="toggle-btn" onclick="switchView('card')">
                        üÉè Cards
                    </button>
                </div>

                <div class="table-view active">
                    <table>
                        <thead>
                            <tr>
                                <th>Matr√≠cula</th>
                                <th>Nome</th>
                                <th>Cargo</th>
                                <th>Departamento</th>
                                <th>Turno</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="employeesTableBody"></tbody>
                    </table>
                </div>

                <div class="card-view" id="cardView"></div>
            </div>
        </div>

        <div class="modal" id="detailModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalEmployeeName">Nome do Funcion√°rio</h3>
                    <div class="matricula-detail" id="modalEmployeeMatricula">
                        Matr√≠cula: #EMP-2024-001
                    </div>
                </div>

                <div class="detail-section">
                    <h4>üìã Dados Pessoais</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <label>CPF:</label>
                            <p id="detailCpf">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Data de Nascimento:</label>
                            <p id="detailNascimento">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Telefone:</label>
                            <p id="detailTelefone">-</p>
                        </div>
                        <div class="detail-item">
                            <label>E-mail:</label>
                            <p id="detailEmail">-</p>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4>üíº Informa√ß√µes Profissionais</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <label>Cargo:</label>
                            <p id="detailCargo">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Departamento:</label>
                            <p id="detailDepartamento">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Data de Admiss√£o:</label>
                            <p id="detailAdmissao">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Turno:</label>
                            <p id="detailTurno">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Supervisor:</label>
                            <p id="detailSupervisor">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Especializa√ß√µes:</label>
                            <p id="detailEspecializacoes">-</p>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4>üí∞ Remunera√ß√£o</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <label>Sal√°rio Base:</label>
                            <p id="detailSalario">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Comiss√£o:</label>
                            <p id="detailComissao">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Meta de Servi√ßos:</label>
                            <p id="detailMetaServicos">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Meta de Faturamento:</label>
                            <p id="detailMetaFaturamento">-</p>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button
                        class="btn-modal edit-btn action-btn"
                        onclick="editEmployee()"
                    >
                        Editar
                    </button>
                    <button
                        class="btn-modal btn-close"
                        onclick="closeDetailModal()"
                    >
                        Fechar
                    </button>
                </div>
            </div>
        </div>

        <script>
            function loadEmployeesFromStorage() {
                const saved = localStorage.getItem('employeesData');
                if (saved) {
                    const data = JSON.parse(saved);
                    return data.map((emp, index) => ({
                        id: index,
                        matricula: emp.matricula || '',
                        nome: emp.nome || '',
                        cpf: emp.cpf || '',
                        dataNascimento: emp.dataNascimento || '',
                        telefone: emp.telefone || '',
                        email: emp.email || '',
                        cargo: emp.cargo || '',
                        departamento: emp.departamento || '',
                        dataAdmissao: emp.dataAdmissao || '',
                        turno: emp.turno || '',
                        supervisor: emp.supervisor || '',
                        especializacoes: emp.especializacoes || [],
                        salario: parseFloat(emp.salario) || 0,
                        comissao: parseFloat(emp.comissao) || 0,
                        metaServicos: parseInt(emp.metaServicos) || 0,
                        metaFaturamento: parseFloat(emp.metaFaturamento) || 0,
                        status: emp.status || 'ativo'
                    }));
                }
                return [];
            }

            function saveEmployeesToStorage() {
                localStorage.setItem('employeesData', JSON.stringify(employees.map(emp => ({
                    matricula: emp.matricula,
                    nome: emp.nome,
                    cpf: emp.cpf,
                    dataNascimento: emp.dataNascimento,
                    telefone: emp.telefone,
                    email: emp.email,
                    cargo: emp.cargo,
                    departamento: emp.departamento,
                    dataAdmissao: emp.dataAdmissao,
                    turno: emp.turno,
                    supervisor: emp.supervisor,
                    especializacoes: emp.especializacoes,
                    salario: emp.salario,
                    comissao: emp.comissao,
                    metaServicos: emp.metaServicos,
                    metaFaturamento: emp.metaFaturamento,
                    status: emp.status
                }))));
            }

            let employees = loadEmployeesFromStorage();
            let currentEmployee = null;

            function renderTable() {
                const tbody = document.getElementById("employeesTableBody");
                tbody.innerHTML = "";

                if (employees.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px; color: #666;">Nenhum funcion√°rio cadastrado. Cadastre funcion√°rios primeiro.</td></tr>';
                    updateStats();
                    return;
                }

                employees.forEach((emp) => {
                    const statusClass = `status-${emp.status}`;
                    const statusText = {
                        ativo: "Ativo",
                        ferias: "F√©rias",
                        afastado: "Afastado",
                    };

                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td>${emp.matricula}</td>
                    <td>${emp.nome}</td>
                    <td>${emp.cargo}</td>
                    <td>${emp.departamento}</td>
                    <td>${emp.turno}</td>
                    <td><span class="status-badge ${statusClass}">${statusText[emp.status]}</span></td>
                    <td>
                        <button class="action-btn" onclick="viewDetails(${emp.id})">Ver</button>
                        <button class="action-btn edit-btn" onclick="editEmployee(${emp.id})">Editar</button>
                        <button class="action-btn delete-btn" onclick="deleteEmployee(${emp.id})">Excluir</button>
                    </td>
                `;
                    tbody.appendChild(row);
                });

                updateStats();
            }

            function renderCards() {
                const cardView = document.getElementById("cardView");
                cardView.innerHTML = "";

                employees.forEach((emp) => {
                    const statusClass = `status-${emp.status}`;
                    const statusText = {
                        ativo: "Ativo",
                        ferias: "F√©rias",
                        afastado: "Afastado",
                    };

                    const card = document.createElement("div");
                    card.className = "employee-card";
                    card.innerHTML = `
                    <div class="employee-card-header">
                        <div>
                            <h3>${emp.nome}</h3>
                            <div class="matricula">${emp.matricula}</div>
                        </div>
                        <span class="status-badge ${statusClass}">${statusText[emp.status]}</span>
                    </div>
                    <div class="employee-info">
                        <strong>Cargo:</strong> ${emp.cargo}
                    </div>
                    <div class="employee-info">
                        <strong>Depto:</strong> ${emp.departamento}
                    </div>
                    <div class="employee-info">
                        <strong>Turno:</strong> ${emp.turno}
                    </div>
                    <div class="employee-info">
                        <strong>Telefone:</strong> ${emp.telefone}
                    </div>
                    <div class="employee-card-actions">
                        <button class="action-btn" onclick="viewDetails(${emp.id})">Ver Detalhes</button>
                        <button class="action-btn edit-btn" onclick="editEmployee(${emp.id})">Editar</button>
                    </div>
                `;
                    cardView.appendChild(card);
                });
            }

            function updateStats() {
                document.getElementById("totalEmployees").textContent =
                    employees.length;
                document.getElementById("activeEmployees").textContent =
                    employees.filter((e) => e.status === "ativo").length;
                document.getElementById("vacationEmployees").textContent =
                    employees.filter((e) => e.status === "ferias").length;

                let avgSalary = 0;
                if (employees.length > 0) {
                    avgSalary = employees.reduce((sum, e) => sum + (e.salario || 0), 0) / employees.length;
                }
                document.getElementById("avgSalary").textContent =
                    "R$ " + avgSalary.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            }

            function switchView(view) {
                const tableView = document.querySelector(".table-view");
                const cardView = document.querySelector(".card-view");
                const buttons = document.querySelectorAll(".toggle-btn");

                buttons.forEach((btn) => btn.classList.remove("active"));

                if (view === "table") {
                    tableView.classList.add("active");
                    cardView.classList.remove("active");
                    buttons[0].classList.add("active");
                } else {
                    tableView.classList.remove("active");
                    cardView.classList.add("active");
                    buttons[1].classList.add("active");
                    renderCards();
                }
            }

            function viewDetails(id) {
                const employee = employees.find((e) => e.id === id);
                if (!employee) return;

                currentEmployee = employee;

                document.getElementById("modalEmployeeName").textContent =
                    employee.nome;
                document.getElementById("modalEmployeeMatricula").textContent =
                    "Matr√≠cula: " + employee.matricula;

                document.getElementById("detailCpf").textContent = employee.cpf;
                document.getElementById("detailNascimento").textContent =
                    new Date(employee.dataNascimento).toLocaleDateString(
                        "pt-BR",
                    );
                document.getElementById("detailTelefone").textContent =
                    employee.telefone;
                document.getElementById("detailEmail").textContent =
                    employee.email || "-";

                document.getElementById("detailCargo").textContent =
                    employee.cargo;
                document.getElementById("detailDepartamento").textContent =
                    employee.departamento;
                document.getElementById("detailAdmissao").textContent =
                    new Date(employee.dataAdmissao).toLocaleDateString("pt-BR");
                document.getElementById("detailTurno").textContent =
                    employee.turno;
                document.getElementById("detailSupervisor").textContent =
                    employee.supervisor || "-";
                document.getElementById("detailEspecializacoes").textContent =
                    employee.especializacoes.length > 0
                        ? employee.especializacoes.join(", ")
                        : "-";

                document.getElementById("detailSalario").textContent =
                    "R$ " + employee.salario.toFixed(2).replace(".", ",");
                document.getElementById("detailComissao").textContent =
                    employee.comissao + "%";
                document.getElementById("detailMetaServicos").textContent =
                    employee.metaServicos + " servi√ßos/m√™s";
                document.getElementById("detailMetaFaturamento").textContent =
                    "R$ " +
                    employee.metaFaturamento
                        .toFixed(2)
                        .replace(/\B(?=(\d{3})+(?!\d))/g, ".")
                        .replace(".", ",");

                document.getElementById("detailModal").classList.add("active");
            }

            function closeDetailModal() {
                document
                    .getElementById("detailModal")
                    .classList.remove("active");
                currentEmployee = null;
            }

            function editEmployee(id) {
                if (id === undefined && currentEmployee) {
                    id = currentEmployee.id;
                }
                alert("Funcionalidade de edi√ß√£o ser√° implementada. ID: " + id);
                closeDetailModal();
            }

            function deleteEmployee(id) {
                const emp = employees.find((e) => e.id === id);
                if (confirm(`Deseja realmente excluir o funcion√°rio "${emp ? emp.nome : ''}"?`)) {
                    employees = employees.filter((e) => e.id !== id);
                    saveEmployeesToStorage();
                    renderTable();
                    renderCards();
                    alert("Funcion√°rio exclu√≠do com sucesso!");
                }
            }

            function filterEmployees() {
                const searchTerm = document
                    .getElementById("searchInput")
                    .value.toLowerCase();
                const filterCargo =
                    document.getElementById("filterCargo").value;
                const filterDepartamento =
                    document.getElementById("filterDepartamento").value;

                const filtered = employees.filter((emp) => {
                    const matchSearch =
                        emp.nome.toLowerCase().includes(searchTerm) ||
                        emp.matricula.toLowerCase().includes(searchTerm);
                    const matchCargo =
                        !filterCargo || emp.cargo === filterCargo;
                    const matchDepartamento =
                        !filterDepartamento ||
                        emp.departamento === filterDepartamento;

                    return matchSearch && matchCargo && matchDepartamento;
                });

                const tbody = document.getElementById("employeesTableBody");
                tbody.innerHTML = "";

                filtered.forEach((emp) => {
                    const statusClass = `status-${emp.status}`;
                    const statusText = {
                        ativo: "Ativo",
                        ferias: "F√©rias",
                        afastado: "Afastado",
                    };

                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td>${emp.matricula}</td>
                    <td>${emp.nome}</td>
                    <td>${emp.cargo}</td>
                    <td>${emp.departamento}</td>
                    <td>${emp.turno}</td>
                    <td><span class="status-badge ${statusClass}">${statusText[emp.status]}</span></td>
                    <td>
                        <button class="action-btn" onclick="viewDetails(${emp.id})">Ver</button>
                        <button class="action-btn edit-btn" onclick="editEmployee(${emp.id})">Editar</button>
                        <button class="action-btn delete-btn" onclick="deleteEmployee(${emp.id})">Excluir</button>
                    </td>
                `;
                    tbody.appendChild(row);
                });

                const cardView = document.getElementById("cardView");
                cardView.innerHTML = "";

                filtered.forEach((emp) => {
                    const statusClass = `status-${emp.status}`;
                    const statusText = {
                        ativo: "Ativo",
                        ferias: "F√©rias",
                        afastado: "Afastado",
                    };

                    const card = document.createElement("div");
                    card.className = "employee-card";
                    card.innerHTML = `
                    <div class="employee-card-header">
                        <div>
                            <h3>${emp.nome}</h3>
                            <div class="matricula">${emp.matricula}</div>
                        </div>
                        <span class="status-badge ${statusClass}">${statusText[emp.status]}</span>
                    </div>
                    <div class="employee-info">
                        <strong>Cargo:</strong> ${emp.cargo}
                    </div>
                    <div class="employee-info">
                        <strong>Depto:</strong> ${emp.departamento}
                    </div>
                    <div class="employee-info">
                        <strong>Turno:</strong> ${emp.turno}
                    </div>
                    <div class="employee-info">
                        <strong>Telefone:</strong> ${emp.telefone}
                    </div>
                    <div class="employee-card-actions">
                        <button class="action-btn" onclick="viewDetails(${emp.id})">Ver Detalhes</button>
                        <button class="action-btn edit-btn" onclick="editEmployee(${emp.id})">Editar</button>
                    </div>
                `;
                    cardView.appendChild(card);
                });
            }

            document
                .getElementById("searchInput")
                .addEventListener("keyup", function (e) {
                    if (e.key === "Enter") {
                        filterEmployees();
                    }
                });

            renderTable();
        </script>
    </body>
</html>
